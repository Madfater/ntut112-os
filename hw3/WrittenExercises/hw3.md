## 10.21

為了計算最大可接受的頁面錯誤率，我們可以按照以下步驟進行：

計算有效存取時間 (EAT) 中可容忍的頁面錯誤服務時間：

EAT = 200 奈秒
記憶體存取時間 = 100 奈秒
可容忍的頁面錯誤服務時間 = EAT - 記憶體存取時間 = 200 奈秒 - 100 奈秒 = 100 奈秒
計算平均頁面錯誤服務時間：

修改頁面錯誤服務時間 = 20 毫秒 = 20,000 奈秒
未修改頁面錯誤服務時間 = 8 毫秒 = 8,000 奈秒
修改頁面機率 = 70%
未修改頁面機率 = 30%
$$EAT = (1-p)(100) + p(100 + (1-.7)(8msec) + (.7)(20msec))$$
$$= 100 - 100p + 100p + (2.4e6)*p + (14e6)*p$$
$$= 100 + (16.4e6)*p$$
$$200 = 100 + (16.4e6)*p$$
$$p = 100/16.4e6 = 6.0975609756097560975609756097561e-6 \approx 6.1e-6$$

Ans=6.1e-6

## 10.24

### FIFO

| 參考頁面 | 頁框 1 | 頁框 2 | 頁框 3 | 是否頁面錯誤 |
|------|------|------|------|--------|
| 3    | 3    | NULL | NULL | 錯誤     |
| 1    | 3    | 1    | NULL | 錯誤     |
| 4    | 3    | 1    | 4    | 錯誤     |
| 2    | 2    | 1    | 4    | 錯誤     |
| 5    | 2    | 5    | 4    | 錯誤     |
| 4    | 2    | 5    | 4    | 正確   |
| 1    | 1    | 5    | 4    | 錯誤     |
| 3    | 1    | 3    | 4    | 錯誤     |
| 5    | 1    | 3    | 5    | 錯誤     |
| 2    | 2    | 3    | 5    | 錯誤     |
| 0    | 2    | 0    | 5    | 錯誤     |
| 1    | 2    | 0    | 1    | 錯誤     |
| 1    | 2    | 0    | 1    | 正確   |
| 0    | 0    | 2    | 1    | 錯誤     |
| 2    | 0    | 2    | 1    | 正確   |
| 3    | 3    | 2    | 1    | 錯誤     |
| 4    | 3    | 4    | 1    | 錯誤     |
| 5    | 3    | 4    | 5    | 錯誤     |
| 0    | 0    | 4    | 5    | 錯誤     |
| 1    | 0    | 1    | 5    | 錯誤     |

共15次

### LRU

| 參考頁面 | 頁框 1 | 頁框 2 | 頁框 3 | 是否頁面錯誤 |
|------|------|------|------|--------|
| 3    | 3    | NULL | NULL | 錯誤     |
| 1    | 3    | 1    | NULL | 錯誤     |
| 4    | 3    | 1    | 4    | 錯誤     |
| 2    | 2    | 1    | 4    | 錯誤     |
| 5    | 2    | 5    | 4    | 錯誤     |
| 4    | 2    | 5    | 4    | 正確   |
| 1    | 1    | 5    | 4    | 錯誤     |
| 3    | 1    | 5    | 3    | 錯誤     |
| 5    | 1    | 5    | 3    | 正確   |
| 2    | 2    | 5    | 3    | 錯誤     |
| 0    | 2    | 0    | 3    | 錯誤     |
| 1    | 1    | 0    | 3    | 錯誤     |
| 1    | 1    | 0    | 3    | 正確   |
| 0    | 1    | 0    | 3    | 正確   |
| 2    | 1    | 2    | 3    | 錯誤     |
| 3    | 1    | 2    | 3    | 正確   |
| 4    | 4    | 2    | 3    | 錯誤     |
| 5    | 4    | 5    | 3    | 錯誤     |
| 0    | 4    | 5    | 0    | 錯誤     |
| 1    | 1    | 5    | 0    | 錯誤     |

共12次

### OPT

| 參考頁面 | 頁框 1 | 頁框 2 | 頁框 3 | 是否頁面錯誤 |
|------|------|------|------|--------|
| 3    | 3    | NULL | NULL | 錯誤     |
| 1    | 3    | 1    | NULL | 錯誤     |
| 4    | 4    | 1    | 3    | 錯誤     |
| 2    | 4    | 2    | 1    | 錯誤     |
| 5    | 4    | 2    | 5    | 錯誤     |
| 4    | 4    | 2    | 5    | NULL   |
| 1    | 4    | 1    | 5    | 錯誤     |
| 3    | 4    | 1    | 3    | NULL   |
| 5    | 4    | 1    | 5    | NULL   |
| 2    | 4    | 2    | 5    | NULL   |
| 0    | 0    | 2    | 5    | 錯誤     |
| 1    | 0    | 1    | 5    | 錯誤     |
| 1    | 0    | 1    | 5    | NULL   |
| 0    | 0    | 1    | 5    | NULL   |
| 2    | 0    | 2    | 5    | NULL   |
| 3    | 0    | 2    | 3    | NULL   |
| 4    | 4    | 2    | 3    | 錯誤     |
| 5    | 4    | 2    | 5    | NULL   |
| 0    | 4    | 2    | 0    | NULL   |
| 1    | 4    | 1    | 0    | 錯誤     |

共9次

## 10.37

抖動 (Thrashing) 是指一個行程頻繁地發生頁面錯誤，導致大部分時間都花在頁面置換上，而實際執行的時間卻很少。這種情況下，系統的效能會嚴重下降。

系統檢測抖動的方法：

CPU 利用率低： 當抖動發生時，CPU 大部分時間都在等待頁面調入，導致 CPU 利用率下降。
頁面錯誤率高： 抖動會導致大量的頁面錯誤，頁面錯誤率會顯著升高。
磁碟 I/O 增加： 由於頻繁的頁面置換，磁碟 I/O 操作會大幅增加。
系統消除抖動的方法：

增加記憶體： 最直接的方法是增加系統的實體記憶體，讓行程有更多空間存放所需的頁面。
減少多工度： 降低同時執行的行程數量，減少對記憶體的需求。
調整工作集： 透過調整行程的工作集大小，確保每個行程都有足夠的頁面在記憶體中。
使用頁面置換演算法： 選擇合適的頁面置換演算法 (如 LRU)，可以減少不必要的頁面置換。
終止行程： 在極端情況下，可以考慮終止一些不重要的行程，釋放記憶體資源。


## 11.13

- 排程演算法：

FCFS (先來先服務)： 按照請求到達的順序服務。
SCAN (電梯演算法)： 磁頭朝一個方向移動，服務所有途中的請求，到達邊界後反向移動。
C-SCAN (循環式 SCAN)： 類似 SCAN，但到達邊界後立即回到另一端，不服務反向途中的請求。
計算磁碟臂移動總距離：

| Method | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | Total |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|-------|
| FCFS   | 2150 | 2069 | 1212 | 2296 | 2800 | 544  | 1618 | 356  | 1523 | 4965 | 3681 | NULL | NULL | 13011 |
| SCAN   | 2150 | 2296 | 2800 | 3681 | 4965 | 4999 | 2069 | 1618 | 1523 | 1212 | 544  | 356  | NULL | 7492  |
| C-SCAN | 2150 | 2296 | 2800 | 3681 | 4965 | 4999 | 0    | 356  | 544  | 1212 | 1523 | 1618 | 2069 | 9917  |


- 結論：

SCAN 演算法的磁碟臂移動總距離最短，其次是 C-SCAN，最後是 FCFS。

## 11.20

RAID level 5 將資料分成多個區塊，並將奇偶校驗資訊分散儲存在不同的磁碟上。

(a) 寫入一個資料區塊時，需要存取以下區塊：

要寫入的資料區塊
儲存該區塊奇偶校驗資訊的區塊
同一條帶 (stripe) 上的其他資料區塊 (用於計算新的奇偶校驗資訊)
因此，總共需要存取 4 個區塊。

(b) 寫入七個連續的資料區塊時，由於 RAID 5 的條帶大小為四個區塊，這七個區塊會跨越兩個條帶。

第一個條帶： 需要存取四個資料區塊、一個奇偶校驗區塊，以及第二個條帶的第一個資料區塊 (用於計算新的奇偶校驗資訊)。
第二個條帶： 需要存取三個資料區塊、一個奇偶校驗區塊，以及第一個條帶的最後一個資料區塊 (用於計算新的奇偶校驗資訊)。
因此，總共需要存取 12 個區塊。

## 11.21

(a) 讀取單個區塊：

RAID level 5: 只需要從存儲該區塊的磁碟讀取資料，因此吞吐量較高。
RAID level 1: 需要從鏡像的兩個磁碟都讀取資料，然後進行比較以確保資料正確性，因此吞吐量較低。
(b) 讀取多個連續區塊：

RAID level 5: 可以並行從多個磁碟讀取資料，但由於需要計算奇偶校驗資訊，吞吐量會受到一定影響。
RAID level 1: 可以並行從鏡像的兩個磁碟組讀取資料，吞吐量較高。
結論：

在讀取單個區塊時，RAID level 5 的吞吐量通常高於 RAID level 1。
在讀取多個連續區塊時，RAID level 1 的吞吐量通常高於 RAID level 5。


## 14.14

(a) 在此系統中，邏輯地址到實體地址的映射方式如下：

- 連續分配 (Contiguous Allocation): 檔案的起始區塊號記錄在檔案資訊中。邏輯區塊號加上起始區塊號，即可得到實體區塊號。
- 鏈結分配 (Linked Allocation): 每個區塊都存儲著下一個區塊的指標。從檔案的起始區塊開始，依次追蹤指標即可找到對應的實體區塊。
- 索引分配 (Indexed Allocation): 檔案資訊中存儲著一個索引區塊的指標。索引區塊包含了檔案所有區塊的指標。邏輯區塊號直接作為索引，從索引區塊中取得對應的實體區塊號。

(b) 如果目前在邏輯區塊 10，想存取邏輯區塊 4，需要讀取的實體區塊數量如下：

- 連續分配: 只需讀取一個實體區塊 (邏輯區塊 4 對應的實體區塊)。
- 鏈結分配: 需要讀取 7 個實體區塊 (從邏輯區塊 10 開始，依次讀取 6 個區塊才能找到邏輯區塊 4)。
- 索引分配: 只需讀取兩個實體區塊 (索引區塊和邏輯區塊 4 對應的實體區塊)。

## 14.15

直接區塊： 12 個區塊 * 8192 bytes/區塊 = 98304 bytes
單間接區塊： 8192 bytes/區塊 / 4 bytes/指標 = 2048 個指標 2048 個指標 * 8192 bytes/區塊 = 16777216 bytes
雙間接區塊： 2048 個指標/區塊 * 2048 個指標/區塊 = 4194304 個指標 4194304 個指標 * 8192 bytes/區塊 = 34359738368 bytes
三間接區塊： 2048 個指標/區塊 * 2048 個指標/區塊 * 2048 個指標/區塊 = 8589934592 個指標 8589934592 個指標 * 8192 bytes/區塊 = 70368744177664 bytes
最大檔案尺寸：

98304 + 16777216 + 34359738368 + 70368744177664 = 70712341565440 bytes

因此，在此檔案系統中，檔案的最大尺寸約為 7 TB。